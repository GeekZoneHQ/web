version: 2.1

# Define the jobs we want to run for this project
jobs:
  build:
    docker:
      - image: 'geekzone/infra'
    steps:
      - checkout
      - run: 
          name: Set and persist variable
          command: |
            PIPELINE_NUMBER=<< pipeline.number >>
            echo ${PIPELINE_NUMBER}
            echo 'export TAG="0.1.${PIPELINE_NUMBER}"' >> "$BASH_ENV"
            source /home/circleci/.bashrc
            echo $TAG