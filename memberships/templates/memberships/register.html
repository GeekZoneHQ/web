{% extends "base.html" %}
{% load widget_tweaks %}

{% block content %}
  <section class="register-login">
    <h2 class="header mb-3">Member Registration</h2>

    {% if recaptcha_enabled %}
    <script>
    /*Execute recaptchaV3 function*/
    grecaptcha.ready(function() {
      grecaptcha.execute("{{ recaptcha_site_key }}", {action: "/register/"}).then(function(token) {
        document.getElementById('recaptchaV3-response').value = token;
      });
    });
    </script>
    {% endif %}

    {% if messages %}
    <ul class="messages">
        {% for message in messages %}
        <li {% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
        {% endfor %}
    </ul>
    {% endif %}

    <p class="mb-3">
      Will you complete this quest to achieve geeky greatness?
      Epic adventurers use a <a class="link" href="http://geek.zone/passwords">password manager</a>!
    </p>
    <p>Membership costs £1 plus the suggested donation of £30 per year.</p>

    <form action="{% url 'register' %}" method="POST">
      {% csrf_token %}

      <div class="ml-4 text-sm">
        {% for field in form %}
          <div class="mb-2 last:mb-3">
            {{ field.errors }}

            <div class="flex items-center">
              {{ field | add_label_class:"mr-2"}}
              
              {% if field.help_text and field.widget_type != "checkbox" %}
                <div class="help-text relative flex justify-center items-center opacity-0 pointer-events-none">
                  <div class="absolute bottom-4 -left-3 py-2 px-3 max-w-2xs sm:max-w-sm w-max bg-gray-600 text-gray-200 text-xs rounded shadow transform">
                    {{ field.help_text | safe }}
                  </div>
                  <svg class="absolute bottom-1.5 left-1 sm:left-0.5 h-3" viewBox="0 0 2 2" xml:space="preserve">
                    <polygon class="fill-current text-gray-600" points="0,0 1,1 2,0"/>
                  </svg>
                </div>
              {% endif %}

              {{ field | add_class:"border-input bg-gray-100 text-gray-800" | add_required_class:"input-required" | add_error_class:"border-red-500" }}

              {% if field.field.required %} <span class="ml-1 text-red-500">*</span> {% endif %}

              {% if field.help_text and field.widget_type == "checkbox" %}
                <div class="ml-2">
                  <div class="relative flex justify-center items-center opacity-0 pointer-events-none">
                    <div class="absolute bottom-1 -left-3 py-2 px-3 max-w-2xs sm:max-w-sm w-max bg-gray-600 text-gray-200 text-xs rounded shadow transform">
                      {{ field.help_text | safe }}
                    </div>
                    <svg class="absolute -bottom-1.5 left-1 sm:left-0.5 h-3" viewBox="0 0 2 2">
                      <polygon class="fill-current text-gray-600" points="0,0 1,1 2,0"/>
                    </svg>
                  </div>
                  <div class="text-2xl sm:text-lg -my-1.5 cursor-pointer" onmouseover="showHelpText(this.previousElementSibling)" onmouseout="hideHelpText(this.previousElementSibling)">&#9432;</div>
                </div>
              {% endif %}  
            </div>
          </div>
        {% endfor %}
      </div>

      <p class="mb-3">
      </p>

      {% if recaptcha_enabled %}
      <input type="hidden" id="recaptcha-v3-response" name="recaptcha-v3-response"/>
      {% endif %}

      <input class="btn mb-3" type="submit" value="Register"/>
    </form>

    <p class="mb-3">Already a member? <a class="link" href="{% url 'memberships_login' %}">Login!</a></p>

    <script>
      for (let helpText of document.getElementsByClassName("help-text")) {
        helpText.nextElementSibling.addEventListener("focus", () => showHelpText(helpText));
        helpText.nextElementSibling.addEventListener("blur", () => hideHelpText(helpText));
      }
    </script>
  </section>
{% endblock %}
